# ========================================
# NGINX OPTIMIZATION FOR VPS (2 Core, 2GB RAM, 40GB SSD)
# ========================================
#
# Save this as: /etc/nginx/conf.d/sk_sharif_optimize.conf
# Then reload: sudo systemctl reload nginx

# Gzip compression
gzip on;
gzip_vary on;
gzip_min_length 1000;
gzip_proxied any;
gzip_types text/plain text/css text/xml text/javascript
            application/x-javascript application/xml+rss
            application/javascript application/json;
gzip_disable "MSIE [1-6]\.";
gzip_comp_level 6;

# Client body size
client_max_body_size 10M;

# Buffer sizes optimized for 2GB RAM
client_body_buffer_size 128k;
client_header_buffer_size 1k;
large_client_header_buffers 4 16k;

# Timeouts
client_header_timeout 20s;
client_body_timeout 20s;
send_timeout 20s;
keepalive_timeout 65s;

# Connection optimization
worker_rlimit_nofile 65535;
worker_connections 512;
multi_accept on;
use epoll;

# Enable TCP optimizations
tcp_nopush on;
tcp_nodelay on;

# Caching headers
map $sent_http_content_type $expires {
    default                    off;
    text/html                  epoch;
    text/css                   max;
    application/javascript     max;
    ~image/                    max;
    ~font/                     max;
}

# FastCGI caching for PHP-FPM
fastcgi_cache_path /var/cache/nginx levels=1:2 keys_zone=LARAVEL:10m max_size=512m inactive=7d use_temp_path=off;
fastcgi_cache_key "$scheme$request_method$host$request_uri";
fastcgi_cache_use_stale updating error timeout invalid_header http_500 http_503;
fastcgi_cache_background_update on;
fastcgi_cache_lock on;

# Security headers
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Logging
access_log /var/log/nginx/sk_sharif_access.log combined buffer=32k flush=5s;
error_log /var/log/nginx/sk_sharif_error.log warn;

# Hide Nginx version
server_tokens off;
